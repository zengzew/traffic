# 轨迹管理平台

## _V2.0.0_

**本地调试**

```
npm run dev
```

**本地打包**

```$xslt
npm run build
```

发布到 cos 环境

```$xslt
npm run test
```

## 项目安装包部署流程

1. git 下载 对应 tags 下的安装包文件 dist.zip ，或者下载源代码 zip 文件（其中包含 dist 文件夹）
2. 解压 dist 文件，打开 cd dist 文件夹路径下
3. 安装项目服务器环境（express）——需 node 环境
    ```$xslt
    npm i express -D
    npm i express-static-gzip -D
    ```
4. 安装成功后，node server.js 运行服务器启动文件，弹出`trace-management is started at http://127.0.0.1:8089 `表示项目启动成功，点击 http://127.0.0.1:8089 链接即可访问。

注意：

-   可在 server.js 文件中 `const port = 8090;` 修改端口号

# 交通安全分析/历史统计分析

历史统计分析页面主要分为**历史情况**和**历史点事件**两部分，历史情况功能为显示交通情况累计数据，包括路段和事件两部分，并根据当日实时数据计算同环比，历史点事件包括一个查询所有交通历史事件的表格。  
页面代码在 src/page/safeAnalyze/dangerHistory，有三个文件：index 主文件，HistoryEvents 为历史事件标签页中的内容， HistorySituation 为历史情况标签页中的内容。  
所需要的所有 api 封装在 uitl/apiV1/safeAnalyze.js 文件，项目引入的时候引入 apiV1 包即可。

-   历史事件页面，应用 flex 布局，自上而下分布为表单组件，表格，和分页器，全部使用 element-ui 组件, element-ui 是全局引入的。

    值得注意的是：

    1. 表单中使用的是两个独立分开的时间选择器，并通过 disabledDate 方法对日期做了以下约束：1. 只能选择当前日期以前 2. 在选择起始日期或结束日期之后，只能选择起始日期之后或结束日期之前的日子。
    2. 表格中的用 vue 过滤器对“道路等级”，“地理空间所属范围”，“事件状态”三个属性做了显示上不同数字返回对应字符串的处理，但不改变 el-原本的值。若表格中显示“error”，则是接口返回的参数有问题。 表格中的“事件发生位置”属性，传入数据但并未显示，通过 button 跳转 **交通事故分析** 页面，并将 event_id 传入到 vuex 中，用来在 **交通事故分析** 检索对应的事件
    3. 表格中的分页是在后端实现的，换句话说每调整一次每页所显示的行数或者跳转到指定页面，都会向后端请求一次数据。

    另外，本页面有以下自适应处理：

    1. 当窗口高度小于表格所能显示的范围时，表格会自动调整高度，并增加竖直方向滚动条以便浏览，表格内容不被底部的分页器覆盖
    2. 分页器（el-pagination）绝对定位固定在页面的底部。

-   历史情况页面，应用 flex 布局，自上而下分布为路段数量环形图和表格组件（centerbox），显示路段当日情况的卡片组件（cardContainer），自上而下分布为事件数量环形图和表格组件（bottombox），显示事件当日情况的卡片组件（bottomCardContainer）  
    值得注意的是：
    1. 在 centerbox 中，为了显示和调整方便，在时间选择器的右侧，增加了一个 fake 不显示的时间选择器组件（timepickerFake）
    2. 获取累计数据返回的截止日期格式为 yyyy-mm-dd，通过过滤器（dateformat）对日期返回 yyyy 年 mm 月 dd 日，但不改变原有的值。
    3. 日期选择器返回的是 13 位时间戳，并且是格林威治标准时间，在请求接口时要转成 10 位的北京时间
    4. 同环比在前端计算，通过过滤器（percent）将计算后的数值精确到两位，并加上百分号。当计算结果为 Infinity 或 isNaN 时显示"——"
    5. 通过 v-if 判断同环比值的大小来决定显示涨跌的上下 icon
